<apex:page controller="smlfcom.SMLStageController" sidebar="false" showHeader="false" standardStylesheets="false" readOnly="true" applyBodyTag="false" applyHtmlTag="false">

    <title>SML Stage View</title>
    <apex:composition template="smlfcom__SMLTemplateV2">
        <apex:define name="body">
            <apex:includeScript value="https://code.highcharts.com/highcharts.js"/>
            <apex:includeScript value="https://code.highcharts.com/modules/exporting.js"/>
            <apex:includeScript value="https://code.highcharts.com/highcharts-more.js"/>
            <apex:includeScript value="https://code.highcharts.com/modules/heatmap.js"/>
            <div class="page-header">
                <div class="container-bs">
                    <div class="title">
                        <h1>Highlights: </h1>
                        <h2>Stage View</h2>
                    </div>
                </div><!-- /.container-bs -->
            </div>
            <div class="container-bs">
                <div class="page-container">
                    <div id="chart_container" style="width:100%; height: 600px"/>
                </div>
            </div><!-- /.container-bs -->
        </apex:define>
    </apex:composition>

    <script>

    var SMLStageView = {};
    SMLStageView.stageViewData = {};

    $(function () {
        SMLStageView.fetchStageViewData();
    });

    SMLStageView.fetchStageViewData = function(){
        Visualforce.remoting.Manager.invokeAction(
            "{!$RemoteAction.SMLStageController.getStageViewData}",
            function(result, event){
                if(event.status){
                    SMLStageView.stageViewData = JSON.parse(result);
                    SMLStageView.createStageViewChart();
                }else{
                    //TODO: error handling
                }
            }
            ,{escape: false}
        );
    }

    SMLStageView.createStageViewChart = function(){
        var _svData = this.stageViewData;
        console.log(_svData);
        $('#chart_container').highcharts({
            chart: {
                type: 'bar'
            },
            title: {
                text: null
            },
            xAxis: {
                categories: _svData.listOfStageNames,
                title: {
                    text: 'Stage Name'
                }
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'Number of Days'
                },
                labels: {
                    overflow: 'justify'
                }
            },
            tooltip: {
                valueSuffix: ' Days'
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        enabled: true
                    }
                }
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'top',
                x: -40,
                y: 80,
                floating: true,
                borderWidth: 1,
                backgroundColor: ((Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'),
                shadow: true
            },
            credits: {
                enabled: false
            },
            series: _svData.stageBarDataSeries
        });
    }
    </script>
</apex:page>